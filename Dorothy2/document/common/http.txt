common\http.dms  for Dorothy2


HTTP/HTTPS wrapper object


Usage
=====

  var url = 'http://example.com/';

  common_load ('http');
  var http = new Http ();
  if (!http.get (url)) {
    return http.retry_or_die ();
  }
  var html = http.data;


Http object's properties
========================

http ... object or null

proxy ... string

autoRedirect ... boolean or string

verbose ... number

gunzip ... boolean

captureFilename ... string

baseUrl ... string or null

previousUrl ... string or null

requestHeader ... object

responseHeader ... object

statusLine ... string

code ... number

data ... string

location ... string or null


Http object's methods
=====================

constructor
new Http (opt)
  opt ... object: property specifier (omittable)
  return value ... Http instance

  e.g.  var http = new Http ({ autoRedirect: true, verbose: 0 });

clone ()
  return value ... Http instance

removeRequestHeader (name)
  name ... string: header name

setRequestHeader (name, value)
  name ... string: header name
  value ... string: value (omittable)

getRequestHeader (name)
  name ... string: header name
  return value ... string or null

removeFlashHeader ()

setFlashHeader (ver)
  ver ... string: version number (omittable)

removeResponseHeader (name)
  name ... string: header name

getResponseHeader (name)
  name ... string: header name
  return value ... string or null

expandUrl (base, url)
  base ... string: base URL
  url ... relative URL (or absolute URL)
  return value ... string or null

get (url)
  url ... string: URL
  return value ... boolean

post (url, postdata)
  url ... string: URL
  postdata ... string: parameters to send
  return value ... boolean

head (url)
  url ... string: URL
  return value ... boolean

getXhr (url)
  url ... string: URL
  return value ... boolean

postXhr (url, postdata)
  url ... string: URL
  postdata ... string: parameters to send
  return value ... boolean

getLocation (url)
  url ... string: URL
  return value ... string or null

postLocation (url, postdata)
  url ... string: URL
  postdata ... string: parameters to send
  return value ... string or null

headLocation (url)
  url ... string: URL
  return value ... string or null

getContentType (url)
  url ... string: URL
  return value ... string or null

postContentType (url, postdata)
  url ... string: URL
  postdata ... string: parameters to send
  return value ... string or null

headContentType (url)
  url ... string: URL
  return value ... string or null

exec (obj)
  obj ... object: method, URL, parameters to send
  return value ... boolean

  obj = {
    method: method,  // 'get' or 'post'
    url: url,
    postdata: parameters_to_send  // need only for 'post'
  };

  e.g.
    var http = new Http ();
    http.get (...);
    var form = (new HtmlForms (http)).getFormByName (...);
    http.exec (form.submit ());

retry_or_die (message, ...)
  message ... string: string(s) to print (omittable)
  return value ... boolean

die (message, ...)
  message ... string: string(s) to print (omittable)

removeUtf8Bom ()
  return value ... boolean

saveFile (args)
  args ... object: { filename: '...', data: '...', ... }
    filename ... string: filename to save
    data ... string: data to save
    rename ... string: number to append when filename is duplicated
  return value ... object { success: ..., filename: ..., error: ... }
    success ... boolean: true or false
    filename ... string: saved filename (full path)
    error ... string: error message

capture (filename)
  filename ... string: filename to save (omittable)
  return value ... object { success: ..., filename: ..., error: ... }

dumpResponse (n)
  n ... number: bytes to dump response body (omittable)
  return value ... string

inflate (s)
  s ... string: deflated data
  return value ... string

  need following file:
    Dorothy2\bin\zlib1.dll (version 1.2.8 or later)


ChangeLog
=========

2014-08-15  version 20140815.0  rentan at rentan.org
  suport HTTP status 308 Permanent Redirect
  remake chunked decoder

2012-03-29  version 1.0
  first release


[EOF]
